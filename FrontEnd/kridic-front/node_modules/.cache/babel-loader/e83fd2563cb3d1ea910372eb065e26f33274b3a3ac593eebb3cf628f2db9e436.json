{"ast":null,"code":"import * as uuid from \"uuid\";\nimport { getEnvironmentVariable, getRuntimeEnvironment } from \"./utils/env.js\";\nimport { Client } from \"./client.js\";\nimport { isTracingEnabled } from \"./env.js\";\nimport { warnOnce } from \"./utils/warn.js\";\nfunction stripNonAlphanumeric(input) {\n  return input.replace(/[-:.]/g, \"\");\n}\nexport function convertToDottedOrderFormat(epoch, runId, executionOrder = 1) {\n  // Date only has millisecond precision, so we use the microseconds to break\n  // possible ties, avoiding incorrect run order\n  const paddedOrder = executionOrder.toFixed(0).slice(0, 3).padStart(3, \"0\");\n  return stripNonAlphanumeric(`${new Date(epoch).toISOString().slice(0, -1)}${paddedOrder}Z`) + runId;\n}\n/**\n * Baggage header information\n */\nclass Baggage {\n  constructor(metadata, tags) {\n    Object.defineProperty(this, \"metadata\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"tags\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    this.metadata = metadata;\n    this.tags = tags;\n  }\n  static fromHeader(value) {\n    const items = value.split(\",\");\n    let metadata = {};\n    let tags = [];\n    for (const item of items) {\n      const [key, uriValue] = item.split(\"=\");\n      const value = decodeURIComponent(uriValue);\n      if (key === \"langsmith-metadata\") {\n        metadata = JSON.parse(value);\n      } else if (key === \"langsmith-tags\") {\n        tags = value.split(\",\");\n      }\n    }\n    return new Baggage(metadata, tags);\n  }\n  toHeader() {\n    const items = [];\n    if (this.metadata && Object.keys(this.metadata).length > 0) {\n      items.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`);\n    }\n    if (this.tags && this.tags.length > 0) {\n      items.push(`langsmith-tags=${encodeURIComponent(this.tags.join(\",\"))}`);\n    }\n    return items.join(\",\");\n  }\n}\nexport class RunTree {\n  constructor(originalConfig) {\n    Object.defineProperty(this, \"id\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"name\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"run_type\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"project_name\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"parent_run\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"child_runs\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"start_time\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"end_time\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"extra\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"tags\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"error\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"serialized\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"inputs\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"outputs\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"reference_example_id\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"client\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"events\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"trace_id\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"dotted_order\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"tracingEnabled\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"execution_order\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"child_execution_order\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    const defaultConfig = RunTree.getDefaultConfig();\n    const {\n      metadata,\n      ...config\n    } = originalConfig;\n    const client = config.client ?? new Client();\n    const dedupedMetadata = {\n      ...metadata,\n      ...config?.extra?.metadata\n    };\n    config.extra = {\n      ...config.extra,\n      metadata: dedupedMetadata\n    };\n    Object.assign(this, {\n      ...defaultConfig,\n      ...config,\n      client\n    });\n    if (!this.trace_id) {\n      if (this.parent_run) {\n        this.trace_id = this.parent_run.trace_id ?? this.id;\n      } else {\n        this.trace_id = this.id;\n      }\n    }\n    this.execution_order ??= 1;\n    this.child_execution_order ??= 1;\n    if (!this.dotted_order) {\n      const currentDottedOrder = convertToDottedOrderFormat(this.start_time, this.id, this.execution_order);\n      if (this.parent_run) {\n        this.dotted_order = this.parent_run.dotted_order + \".\" + currentDottedOrder;\n      } else {\n        this.dotted_order = currentDottedOrder;\n      }\n    }\n  }\n  static getDefaultConfig() {\n    return {\n      id: uuid.v4(),\n      run_type: \"chain\",\n      project_name: getEnvironmentVariable(\"LANGCHAIN_PROJECT\") ?? getEnvironmentVariable(\"LANGCHAIN_SESSION\") ??\n      // TODO: Deprecate\n      \"default\",\n      child_runs: [],\n      api_url: getEnvironmentVariable(\"LANGCHAIN_ENDPOINT\") ?? \"http://localhost:1984\",\n      api_key: getEnvironmentVariable(\"LANGCHAIN_API_KEY\"),\n      caller_options: {},\n      start_time: Date.now(),\n      serialized: {},\n      inputs: {},\n      extra: {}\n    };\n  }\n  createChild(config) {\n    const child_execution_order = this.child_execution_order + 1;\n    const child = new RunTree({\n      ...config,\n      parent_run: this,\n      project_name: this.project_name,\n      client: this.client,\n      tracingEnabled: this.tracingEnabled,\n      execution_order: child_execution_order,\n      child_execution_order: child_execution_order\n    });\n    // propagate child_execution_order upwards\n    const visited = new Set();\n    let current = this;\n    while (current != null && !visited.has(current.id)) {\n      visited.add(current.id);\n      current.child_execution_order = Math.max(current.child_execution_order, child_execution_order);\n      current = current.parent_run;\n    }\n    this.child_runs.push(child);\n    return child;\n  }\n  async end(outputs, error, endTime = Date.now()) {\n    this.outputs = this.outputs ?? outputs;\n    this.error = this.error ?? error;\n    this.end_time = this.end_time ?? endTime;\n  }\n  _convertToCreate(run, runtimeEnv, excludeChildRuns = true) {\n    const runExtra = run.extra ?? {};\n    if (!runExtra.runtime) {\n      runExtra.runtime = {};\n    }\n    if (runtimeEnv) {\n      for (const [k, v] of Object.entries(runtimeEnv)) {\n        if (!runExtra.runtime[k]) {\n          runExtra.runtime[k] = v;\n        }\n      }\n    }\n    let child_runs;\n    let parent_run_id;\n    if (!excludeChildRuns) {\n      child_runs = run.child_runs.map(child_run => this._convertToCreate(child_run, runtimeEnv, excludeChildRuns));\n      parent_run_id = undefined;\n    } else {\n      parent_run_id = run.parent_run?.id;\n      child_runs = [];\n    }\n    const persistedRun = {\n      id: run.id,\n      name: run.name,\n      start_time: run.start_time,\n      end_time: run.end_time,\n      run_type: run.run_type,\n      reference_example_id: run.reference_example_id,\n      extra: runExtra,\n      serialized: run.serialized,\n      error: run.error,\n      inputs: run.inputs,\n      outputs: run.outputs,\n      session_name: run.project_name,\n      child_runs: child_runs,\n      parent_run_id: parent_run_id,\n      trace_id: run.trace_id,\n      dotted_order: run.dotted_order,\n      tags: run.tags\n    };\n    return persistedRun;\n  }\n  async postRun(excludeChildRuns = true) {\n    const runtimeEnv = await getRuntimeEnvironment();\n    const runCreate = await this._convertToCreate(this, runtimeEnv, true);\n    await this.client.createRun(runCreate);\n    if (!excludeChildRuns) {\n      warnOnce(\"Posting with excludeChildRuns=false is deprecated and will be removed in a future version.\");\n      for (const childRun of this.child_runs) {\n        await childRun.postRun(false);\n      }\n    }\n  }\n  async patchRun() {\n    const runUpdate = {\n      end_time: this.end_time,\n      error: this.error,\n      inputs: this.inputs,\n      outputs: this.outputs,\n      parent_run_id: this.parent_run?.id,\n      reference_example_id: this.reference_example_id,\n      extra: this.extra,\n      events: this.events,\n      dotted_order: this.dotted_order,\n      trace_id: this.trace_id,\n      tags: this.tags\n    };\n    await this.client.updateRun(this.id, runUpdate);\n  }\n  toJSON() {\n    return this._convertToCreate(this, undefined, false);\n  }\n  static fromRunnableConfig(parentConfig, props) {\n    // We only handle the callback manager case for now\n    const callbackManager = parentConfig?.callbacks;\n    let parentRun;\n    let projectName;\n    let client;\n    let tracingEnabled = isTracingEnabled();\n    if (callbackManager) {\n      const parentRunId = callbackManager?.getParentRunId?.() ?? \"\";\n      const langChainTracer = callbackManager?.handlers?.find(handler => handler?.name == \"langchain_tracer\");\n      parentRun = langChainTracer?.getRun?.(parentRunId);\n      projectName = langChainTracer?.projectName;\n      client = langChainTracer?.client;\n      tracingEnabled = tracingEnabled || !!langChainTracer;\n    }\n    if (!parentRun) {\n      return new RunTree({\n        ...props,\n        client,\n        tracingEnabled,\n        project_name: projectName\n      });\n    }\n    const parentRunTree = new RunTree({\n      name: parentRun.name,\n      id: parentRun.id,\n      client,\n      tracingEnabled,\n      project_name: projectName,\n      tags: [...new Set((parentRun?.tags ?? []).concat(parentConfig?.tags ?? []))],\n      extra: {\n        metadata: {\n          ...parentRun?.extra?.metadata,\n          ...parentConfig?.metadata\n        }\n      }\n    });\n    return parentRunTree.createChild(props);\n  }\n  static fromDottedOrder(dottedOrder) {\n    return this.fromHeaders({\n      \"langsmith-trace\": dottedOrder\n    });\n  }\n  static fromHeaders(headers, inheritArgs) {\n    const rawHeaders = \"get\" in headers && typeof headers.get === \"function\" ? {\n      \"langsmith-trace\": headers.get(\"langsmith-trace\"),\n      baggage: headers.get(\"baggage\")\n    } : headers;\n    const headerTrace = rawHeaders[\"langsmith-trace\"];\n    if (!headerTrace || typeof headerTrace !== \"string\") return undefined;\n    const parentDottedOrder = headerTrace.trim();\n    const parsedDottedOrder = parentDottedOrder.split(\".\").map(part => {\n      const [strTime, uuid] = part.split(\"Z\");\n      return {\n        strTime,\n        time: Date.parse(strTime + \"Z\"),\n        uuid\n      };\n    });\n    const traceId = parsedDottedOrder[0].uuid;\n    const config = {\n      ...inheritArgs,\n      name: inheritArgs?.[\"name\"] ?? \"parent\",\n      run_type: inheritArgs?.[\"run_type\"] ?? \"chain\",\n      start_time: inheritArgs?.[\"start_time\"] ?? Date.now(),\n      id: parsedDottedOrder.at(-1)?.uuid,\n      trace_id: traceId,\n      dotted_order: parentDottedOrder\n    };\n    if (rawHeaders[\"baggage\"] && typeof rawHeaders[\"baggage\"] === \"string\") {\n      const baggage = Baggage.fromHeader(rawHeaders[\"baggage\"]);\n      config.metadata = baggage.metadata;\n      config.tags = baggage.tags;\n    }\n    return new RunTree(config);\n  }\n  toHeaders(headers) {\n    const result = {\n      \"langsmith-trace\": this.dotted_order,\n      baggage: new Baggage(this.extra?.metadata, this.tags).toHeader()\n    };\n    if (headers) {\n      for (const [key, value] of Object.entries(result)) {\n        headers.set(key, value);\n      }\n    }\n    return result;\n  }\n}\nexport function isRunTree(x) {\n  return x !== undefined && typeof x.createChild === \"function\" && typeof x.postRun === \"function\";\n}\nfunction containsLangChainTracerLike(x) {\n  return Array.isArray(x) && x.some(callback => {\n    return typeof callback.name === \"string\" && callback.name === \"langchain_tracer\";\n  });\n}\nexport function isRunnableConfigLike(x) {\n  // Check that it's an object with a callbacks arg\n  // that has either a CallbackManagerLike object with a langchain tracer within it\n  // or an array with a LangChainTracerLike object within it\n  return x !== undefined && typeof x.callbacks === \"object\" && (\n  // Callback manager with a langchain tracer\n  containsLangChainTracerLike(x.callbacks?.handlers) ||\n  // Or it's an array with a LangChainTracerLike object within it\n  containsLangChainTracerLike(x.callbacks));\n}","map":{"version":3,"names":["uuid","getEnvironmentVariable","getRuntimeEnvironment","Client","isTracingEnabled","warnOnce","stripNonAlphanumeric","input","replace","convertToDottedOrderFormat","epoch","runId","executionOrder","paddedOrder","toFixed","slice","padStart","Date","toISOString","Baggage","constructor","metadata","tags","Object","defineProperty","enumerable","configurable","writable","value","fromHeader","items","split","item","key","uriValue","decodeURIComponent","JSON","parse","toHeader","keys","length","push","encodeURIComponent","stringify","join","RunTree","originalConfig","defaultConfig","getDefaultConfig","config","client","dedupedMetadata","extra","assign","trace_id","parent_run","id","execution_order","child_execution_order","dotted_order","currentDottedOrder","start_time","v4","run_type","project_name","child_runs","api_url","api_key","caller_options","now","serialized","inputs","createChild","child","tracingEnabled","visited","Set","current","has","add","Math","max","end","outputs","error","endTime","end_time","_convertToCreate","run","runtimeEnv","excludeChildRuns","runExtra","runtime","k","v","entries","parent_run_id","map","child_run","undefined","persistedRun","name","reference_example_id","session_name","postRun","runCreate","createRun","childRun","patchRun","runUpdate","events","updateRun","toJSON","fromRunnableConfig","parentConfig","props","callbackManager","callbacks","parentRun","projectName","parentRunId","getParentRunId","langChainTracer","handlers","find","handler","getRun","parentRunTree","concat","fromDottedOrder","dottedOrder","fromHeaders","headers","inheritArgs","rawHeaders","get","baggage","headerTrace","parentDottedOrder","trim","parsedDottedOrder","part","strTime","time","traceId","at","toHeaders","result","set","isRunTree","x","containsLangChainTracerLike","Array","isArray","some","callback","isRunnableConfigLike"],"sources":["C:/Users/lucil/Gen-AI-Contest/FrontEnd/kridic-front/node_modules/langsmith/dist/run_trees.js"],"sourcesContent":["import * as uuid from \"uuid\";\nimport { getEnvironmentVariable, getRuntimeEnvironment, } from \"./utils/env.js\";\nimport { Client } from \"./client.js\";\nimport { isTracingEnabled } from \"./env.js\";\nimport { warnOnce } from \"./utils/warn.js\";\nfunction stripNonAlphanumeric(input) {\n    return input.replace(/[-:.]/g, \"\");\n}\nexport function convertToDottedOrderFormat(epoch, runId, executionOrder = 1) {\n    // Date only has millisecond precision, so we use the microseconds to break\n    // possible ties, avoiding incorrect run order\n    const paddedOrder = executionOrder.toFixed(0).slice(0, 3).padStart(3, \"0\");\n    return (stripNonAlphanumeric(`${new Date(epoch).toISOString().slice(0, -1)}${paddedOrder}Z`) + runId);\n}\n/**\n * Baggage header information\n */\nclass Baggage {\n    constructor(metadata, tags) {\n        Object.defineProperty(this, \"metadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"tags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.metadata = metadata;\n        this.tags = tags;\n    }\n    static fromHeader(value) {\n        const items = value.split(\",\");\n        let metadata = {};\n        let tags = [];\n        for (const item of items) {\n            const [key, uriValue] = item.split(\"=\");\n            const value = decodeURIComponent(uriValue);\n            if (key === \"langsmith-metadata\") {\n                metadata = JSON.parse(value);\n            }\n            else if (key === \"langsmith-tags\") {\n                tags = value.split(\",\");\n            }\n        }\n        return new Baggage(metadata, tags);\n    }\n    toHeader() {\n        const items = [];\n        if (this.metadata && Object.keys(this.metadata).length > 0) {\n            items.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`);\n        }\n        if (this.tags && this.tags.length > 0) {\n            items.push(`langsmith-tags=${encodeURIComponent(this.tags.join(\",\"))}`);\n        }\n        return items.join(\",\");\n    }\n}\nexport class RunTree {\n    constructor(originalConfig) {\n        Object.defineProperty(this, \"id\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"run_type\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"project_name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"parent_run\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"child_runs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"start_time\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"end_time\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"extra\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"tags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"error\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"serialized\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"outputs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"reference_example_id\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"client\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"events\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"trace_id\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"dotted_order\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"tracingEnabled\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"execution_order\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"child_execution_order\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        const defaultConfig = RunTree.getDefaultConfig();\n        const { metadata, ...config } = originalConfig;\n        const client = config.client ?? new Client();\n        const dedupedMetadata = {\n            ...metadata,\n            ...config?.extra?.metadata,\n        };\n        config.extra = { ...config.extra, metadata: dedupedMetadata };\n        Object.assign(this, { ...defaultConfig, ...config, client });\n        if (!this.trace_id) {\n            if (this.parent_run) {\n                this.trace_id = this.parent_run.trace_id ?? this.id;\n            }\n            else {\n                this.trace_id = this.id;\n            }\n        }\n        this.execution_order ??= 1;\n        this.child_execution_order ??= 1;\n        if (!this.dotted_order) {\n            const currentDottedOrder = convertToDottedOrderFormat(this.start_time, this.id, this.execution_order);\n            if (this.parent_run) {\n                this.dotted_order =\n                    this.parent_run.dotted_order + \".\" + currentDottedOrder;\n            }\n            else {\n                this.dotted_order = currentDottedOrder;\n            }\n        }\n    }\n    static getDefaultConfig() {\n        return {\n            id: uuid.v4(),\n            run_type: \"chain\",\n            project_name: getEnvironmentVariable(\"LANGCHAIN_PROJECT\") ??\n                getEnvironmentVariable(\"LANGCHAIN_SESSION\") ?? // TODO: Deprecate\n                \"default\",\n            child_runs: [],\n            api_url: getEnvironmentVariable(\"LANGCHAIN_ENDPOINT\") ?? \"http://localhost:1984\",\n            api_key: getEnvironmentVariable(\"LANGCHAIN_API_KEY\"),\n            caller_options: {},\n            start_time: Date.now(),\n            serialized: {},\n            inputs: {},\n            extra: {},\n        };\n    }\n    createChild(config) {\n        const child_execution_order = this.child_execution_order + 1;\n        const child = new RunTree({\n            ...config,\n            parent_run: this,\n            project_name: this.project_name,\n            client: this.client,\n            tracingEnabled: this.tracingEnabled,\n            execution_order: child_execution_order,\n            child_execution_order: child_execution_order,\n        });\n        // propagate child_execution_order upwards\n        const visited = new Set();\n        let current = this;\n        while (current != null && !visited.has(current.id)) {\n            visited.add(current.id);\n            current.child_execution_order = Math.max(current.child_execution_order, child_execution_order);\n            current = current.parent_run;\n        }\n        this.child_runs.push(child);\n        return child;\n    }\n    async end(outputs, error, endTime = Date.now()) {\n        this.outputs = this.outputs ?? outputs;\n        this.error = this.error ?? error;\n        this.end_time = this.end_time ?? endTime;\n    }\n    _convertToCreate(run, runtimeEnv, excludeChildRuns = true) {\n        const runExtra = run.extra ?? {};\n        if (!runExtra.runtime) {\n            runExtra.runtime = {};\n        }\n        if (runtimeEnv) {\n            for (const [k, v] of Object.entries(runtimeEnv)) {\n                if (!runExtra.runtime[k]) {\n                    runExtra.runtime[k] = v;\n                }\n            }\n        }\n        let child_runs;\n        let parent_run_id;\n        if (!excludeChildRuns) {\n            child_runs = run.child_runs.map((child_run) => this._convertToCreate(child_run, runtimeEnv, excludeChildRuns));\n            parent_run_id = undefined;\n        }\n        else {\n            parent_run_id = run.parent_run?.id;\n            child_runs = [];\n        }\n        const persistedRun = {\n            id: run.id,\n            name: run.name,\n            start_time: run.start_time,\n            end_time: run.end_time,\n            run_type: run.run_type,\n            reference_example_id: run.reference_example_id,\n            extra: runExtra,\n            serialized: run.serialized,\n            error: run.error,\n            inputs: run.inputs,\n            outputs: run.outputs,\n            session_name: run.project_name,\n            child_runs: child_runs,\n            parent_run_id: parent_run_id,\n            trace_id: run.trace_id,\n            dotted_order: run.dotted_order,\n            tags: run.tags,\n        };\n        return persistedRun;\n    }\n    async postRun(excludeChildRuns = true) {\n        const runtimeEnv = await getRuntimeEnvironment();\n        const runCreate = await this._convertToCreate(this, runtimeEnv, true);\n        await this.client.createRun(runCreate);\n        if (!excludeChildRuns) {\n            warnOnce(\"Posting with excludeChildRuns=false is deprecated and will be removed in a future version.\");\n            for (const childRun of this.child_runs) {\n                await childRun.postRun(false);\n            }\n        }\n    }\n    async patchRun() {\n        const runUpdate = {\n            end_time: this.end_time,\n            error: this.error,\n            inputs: this.inputs,\n            outputs: this.outputs,\n            parent_run_id: this.parent_run?.id,\n            reference_example_id: this.reference_example_id,\n            extra: this.extra,\n            events: this.events,\n            dotted_order: this.dotted_order,\n            trace_id: this.trace_id,\n            tags: this.tags,\n        };\n        await this.client.updateRun(this.id, runUpdate);\n    }\n    toJSON() {\n        return this._convertToCreate(this, undefined, false);\n    }\n    static fromRunnableConfig(parentConfig, props) {\n        // We only handle the callback manager case for now\n        const callbackManager = parentConfig?.callbacks;\n        let parentRun;\n        let projectName;\n        let client;\n        let tracingEnabled = isTracingEnabled();\n        if (callbackManager) {\n            const parentRunId = callbackManager?.getParentRunId?.() ?? \"\";\n            const langChainTracer = callbackManager?.handlers?.find((handler) => handler?.name == \"langchain_tracer\");\n            parentRun = langChainTracer?.getRun?.(parentRunId);\n            projectName = langChainTracer?.projectName;\n            client = langChainTracer?.client;\n            tracingEnabled = tracingEnabled || !!langChainTracer;\n        }\n        if (!parentRun) {\n            return new RunTree({\n                ...props,\n                client,\n                tracingEnabled,\n                project_name: projectName,\n            });\n        }\n        const parentRunTree = new RunTree({\n            name: parentRun.name,\n            id: parentRun.id,\n            client,\n            tracingEnabled,\n            project_name: projectName,\n            tags: [\n                ...new Set((parentRun?.tags ?? []).concat(parentConfig?.tags ?? [])),\n            ],\n            extra: {\n                metadata: {\n                    ...parentRun?.extra?.metadata,\n                    ...parentConfig?.metadata,\n                },\n            },\n        });\n        return parentRunTree.createChild(props);\n    }\n    static fromDottedOrder(dottedOrder) {\n        return this.fromHeaders({ \"langsmith-trace\": dottedOrder });\n    }\n    static fromHeaders(headers, inheritArgs) {\n        const rawHeaders = \"get\" in headers && typeof headers.get === \"function\"\n            ? {\n                \"langsmith-trace\": headers.get(\"langsmith-trace\"),\n                baggage: headers.get(\"baggage\"),\n            }\n            : headers;\n        const headerTrace = rawHeaders[\"langsmith-trace\"];\n        if (!headerTrace || typeof headerTrace !== \"string\")\n            return undefined;\n        const parentDottedOrder = headerTrace.trim();\n        const parsedDottedOrder = parentDottedOrder.split(\".\").map((part) => {\n            const [strTime, uuid] = part.split(\"Z\");\n            return { strTime, time: Date.parse(strTime + \"Z\"), uuid };\n        });\n        const traceId = parsedDottedOrder[0].uuid;\n        const config = {\n            ...inheritArgs,\n            name: inheritArgs?.[\"name\"] ?? \"parent\",\n            run_type: inheritArgs?.[\"run_type\"] ?? \"chain\",\n            start_time: inheritArgs?.[\"start_time\"] ?? Date.now(),\n            id: parsedDottedOrder.at(-1)?.uuid,\n            trace_id: traceId,\n            dotted_order: parentDottedOrder,\n        };\n        if (rawHeaders[\"baggage\"] && typeof rawHeaders[\"baggage\"] === \"string\") {\n            const baggage = Baggage.fromHeader(rawHeaders[\"baggage\"]);\n            config.metadata = baggage.metadata;\n            config.tags = baggage.tags;\n        }\n        return new RunTree(config);\n    }\n    toHeaders(headers) {\n        const result = {\n            \"langsmith-trace\": this.dotted_order,\n            baggage: new Baggage(this.extra?.metadata, this.tags).toHeader(),\n        };\n        if (headers) {\n            for (const [key, value] of Object.entries(result)) {\n                headers.set(key, value);\n            }\n        }\n        return result;\n    }\n}\nexport function isRunTree(x) {\n    return (x !== undefined &&\n        typeof x.createChild === \"function\" &&\n        typeof x.postRun === \"function\");\n}\nfunction containsLangChainTracerLike(x) {\n    return (Array.isArray(x) &&\n        x.some((callback) => {\n            return (typeof callback.name === \"string\" &&\n                callback.name === \"langchain_tracer\");\n        }));\n}\nexport function isRunnableConfigLike(x) {\n    // Check that it's an object with a callbacks arg\n    // that has either a CallbackManagerLike object with a langchain tracer within it\n    // or an array with a LangChainTracerLike object within it\n    return (x !== undefined &&\n        typeof x.callbacks === \"object\" &&\n        // Callback manager with a langchain tracer\n        (containsLangChainTracerLike(x.callbacks?.handlers) ||\n            // Or it's an array with a LangChainTracerLike object within it\n            containsLangChainTracerLike(x.callbacks)));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}